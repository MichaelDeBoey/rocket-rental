datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id       String  @id @unique @default(cuid())
  email    String  @unique
  username String  @unique
  name     String?
  imageUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  password    Password?
  contactInfo ContactInfo?
  host        Host?
  renter      Renter?
  admin       Admin?
  chats       Chat[]
  messages    Message[]
}

model Password {
  hash String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

model ContactInfo {
  id      String  @id @unique @default(cuid())
  email   String?
  phone   String?
  address String?
  city    String?
  state   String?
  zip     String?
  country String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

model Host {
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  bio String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ships         Ship[]
  reviews       HostReview[]
  renterReviews RenterReview[]
}

model Renter {
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  bio String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings    Booking[]
  shipReviews ShipReview[]
  hostReviews HostReview[]
  reviews     RenterReview[]
}

model Admin {
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShipBrand {
  id          String @id @unique @default(cuid())
  name        String
  description String
  imageUrl    String
  ships       Ship[]
}

model Ship {
  id          String @id @unique @default(cuid())
  name        String
  capacity    Int
  description String
  imageUrl    String

  dailyCharge Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand   ShipBrand @relation(fields: [brandId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  brandId String

  host   Host   @relation(fields: [hostId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  hostId String

  starport   Starport @relation(fields: [starportId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  starportId String

  bookings Booking[]
  reviews  ShipReview[]
}

model Starport {
  id          String @id @unique @default(cuid())
  name        String
  description String
  imageUrl    String
  latitude    Float
  longitude   Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ships Ship[]
}

model City {
  id        String @id @unique @default(cuid())
  name      String
  country   String
  latitude  Float
  longitude Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Booking {
  id         String   @id @unique @default(cuid())
  startDate  DateTime
  endDate    DateTime
  totalPrice Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  renter   Renter @relation(fields: [renterId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  renterId String

  ship   Ship   @relation(fields: [shipId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  shipId String

  shipReview   ShipReview?
  hostReview   HostReview?
  renterReview RenterReview?
}

/// Review of a ship by the renter
model ShipReview {
  id          String @id @unique @default(cuid())
  rating      Int
  description String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// the renter who reviewed the ship
  renter   Renter @relation(fields: [renterId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  renterId String

  /// the ship that was reviewed
  ship      Ship    @relation(fields: [shipId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  shipId    String
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bookingId String  @unique
}

/// Review of a host by the renter
model HostReview {
  id          String @id @unique @default(cuid())
  rating      Int
  description String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// the renter who reviewed the host
  renter   Renter @relation(fields: [renterId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  renterId String

  /// the host that was reviewed
  host      Host    @relation(fields: [hostId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  hostId    String
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String  @unique
}

/// Review by the renter by the host
model RenterReview {
  id          String @id @unique @default(cuid())
  rating      Int
  description String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// the host who reviewed the renter
  renter   Renter @relation(fields: [renterId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  renterId String

  /// the renter that was reviewed
  host      Host    @relation(fields: [hostId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  hostId    String
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String  @unique
}

model Chat {
  id String @id @unique @default(cuid())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users    User[]
  messages Message[]
}

model Message {
  id        String   @id @unique @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chat   Chat   @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  chatId String

  sender   User   @relation(fields: [senderId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  senderId String
}
